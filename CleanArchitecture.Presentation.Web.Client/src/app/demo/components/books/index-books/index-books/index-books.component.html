
<ng-container *ngIf="isInitializing == true; else isInitializedTemplate">
    <app-page-loading></app-page-loading>
</ng-container>

<ng-template #isInitializedTemplate>

    <!--entity-menu-->
    <app-entity-menu>
        <ng-template #brand>
            Books
        </ng-template>

        <ng-template #items>
            <p-button label="New Book"
                      icon="pi pi-plus"
                      pTooltip="Add new record"
                      tooltipPosition="bottom"
                      (onClick)="showAddBookModal()" />
        </ng-template>
    </app-entity-menu>

    <div class="pt-3"></div>

    <!--content-->
    <div class="card">

        <!--filter-bar-->
        <div class="flex justify-content-between flex-wrap pb-4">
            <div class="flex align-items-center justify-content-center formgroup-inline gap-2">
                <input pInputText
                       id="search"
                       type="text"
                       placeholder="Search"
                       class="p-inputtext p-component p-element"
                       [(ngModel)]="requestParameter.searchString">
            </div>
            <div class="flex align-items-center justify-content-center gap-2">
                <p-button label="Clear"
                          icon="pi pi-times"
                          pTooltip="Clear filters"
                          tooltipPosition="bottom"
                          [outlined]="true"
                          (onClick)="onClickRefresh()" />
                <p-button label="Filter"
                          pTooltip="Filter data"
                          tooltipPosition="bottom"
                          icon="pi pi-filter"
                          [outlined]="true"
                          (onClick)="onClickSearch()" />
            </div>
        </div>

        <app-divider></app-divider>

        <div class="pt-5"></div>

        <!--table-data-->
        <div class="grid">
            <div class="col">
                <p-table styleClass="p-datatable-sm p-datatable-striped"
                         responsiveLayout="stack" 
                         [breakpoint]="'960px'"
                         [customSort]="true"
                         [value]="BookData.data"
                         [paginator]="true"
                         [rows]="requestParameter.pageSize"
                         [rowsPerPageOptions]="[10, 20, 50, 100]"
                         [totalRecords]="BookData.totalRecords"
                         (onPage)="onPageChange($event)"
                         (sortFunction)="sortBooks($event)">
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 2rem">#</th>
                            <th pSortableColumn="title">Title <p-sortIcon field="title"></p-sortIcon></th>
                            <th>ISBN</th>
                            <th pSortableColumn="price">Price <p-sortIcon field="price"></p-sortIcon></th>
                            <th style="width:20%">Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-book let-rowIndex="rowIndex">
                        <tr>
                            <td><span class="p-column-title">#</span>{{ rowIndex + 1 }}</td>
                            <td><span class="p-column-title">Title</span>{{ book.title }}</td>
                            <td><span class="p-column-title">ISBN</span>{{ book.isbn }}</td>
                            <td><span class="p-column-title">Price</span>{{ book.price | currency:'USD':'symbol':'1.2-2' }}</td>
                            <td>
                                <div class="flex flex-wrap column-gap-1 row-gap-1">
                                    <p-button pTooltip="Edit"
                                              tooltipPosition="bottom"
                                              icon="pi pi-pencil"
                                              size="small"
                                              (click)="onClickView(book.id)" />
                                    <p-button pTooltip="Delete"
                                              tooltipPosition="bottom"
                                              icon="pi pi-trash"
                                              severity="danger"
                                              size="small"
                                              (click)="onClickDelete(book.id)" />
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="5">
                                No records found
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>
</ng-template>

<!--add vehicle modal-->
<p-dialog header="New Book"
          [modal]="true"
          [(visible)]="isAddBookModalVisible"
          [style]="{ width: '50rem' }">

    <form [formGroup]="addBookForm">
        <div class="p-fluid">
            <div class="field">
                <label class="font-medium" htmlFor="title">Title</label>
                <input pInputText
                        id="title"
                        placeholder="Title"
                        formControlName="title"
                        type="text"
                        [ngClass]="{'ng-dirty ng-invalid': addBookForm.get('title')?.invalid && addBookForm.get('title')?.touched}" />
                <small class="text-red-700" *ngIf="addBookForm.get('title')?.invalid && addBookForm.get('title')?.touched">
                    {{ getErrorMessage('title') }}
                </small>
            </div>
        </div>
        <div class="p-fluid">
            <div class="field">
                <label class="font-medium" htmlFor="isbn">ISBN</label>
                <input pInputText
                        id="isbn"
                        placeholder="ISBN"
                        formControlName="isbn"
                        type="text"
                        [ngClass]="{'ng-dirty ng-invalid': addBookForm.get('isbn')?.invalid && addBookForm.get('isbn')?.touched}" />
                <small class="text-red-700" *ngIf="addBookForm.get('isbn')?.invalid && addBookForm.get('isbn')?.touched">
                    {{ getErrorMessage('isbn') }}
                </small>
            </div>
        </div>
        <div class="p-fluid">
            <div class="field">
                <label class="font-medium" htmlFor="summary">Summary</label>
                <input pInputText
                        id="summary"
                        placeholder="Summary"
                        formControlName="summary"
                        type="text"
                        [ngClass]="{'ng-dirty ng-invalid': addBookForm.get('summary')?.invalid && addBookForm.get('summary')?.touched}" />
                <small class="text-red-700" *ngIf="addBookForm.get('summary')?.invalid && addBookForm.get('summary')?.touched">
                    {{ getErrorMessage('summary') }}
                </small>
            </div>
        </div>
        
        <div class="p-fluid">
            <div class="field">
                <label class="font-medium" htmlFor="price">Price</label>
                <p-inputNumber id="integeronly" 
                               formControlName="price"
                               mode="currency" 
                               currency="USD"
                               [minFractionDigits]="2" 
                               [maxFractionDigits]="2"
                               [ngClass]="{'ng-dirty ng-invalid': addBookForm.get('price')?.invalid && addBookForm.get('price')?.touched}" />
                <small class="text-red-700" *ngIf="addBookForm.get('price')?.invalid && addBookForm.get('price')?.touched">
                    {{ getErrorMessage('price') }}
                </small>
            </div>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-end gap-2">
            <p-button label="Cancel" severity="secondary" (onClick)="isAddBookModalVisible = false" />
            <p-button label="Save" (onClick)="onSubmitAddBookForm()" />
        </div>
    </ng-template>

</p-dialog>

<!--page processing-->
<app-page-processing *ngIf="isBusy"></app-page-processing>

<!--toast-->
<p-toast></p-toast>
