
<ng-container *ngIf="isInitializing == true; else isInitializedTemplate">
    <app-page-loading></app-page-loading>
</ng-container>

<ng-template #isInitializedTemplate>

    <!--entity-menu-->
    <app-entity-menu>
        <ng-template #brand>
            Costs
        </ng-template>

        <ng-template #items>
            <p-button label="Add Cost"
                      icon="pi pi-plus"
                      pTooltip="Add new record"
                      tooltipPosition="bottom"
                      (onClick)="showAddCostModal()" />
        </ng-template>
    </app-entity-menu>

    <div class="pt-3"></div>

    <!--content-->
    <div class="card">

        <!--filter-bar-->
        <div class="flex justify-content-between flex-wrap pb-4">
            <div class="flex align-items-center justify-content-center formgroup-inline gap-2">
                <p-calendar id="date"
                        dateFormat="dd-M-yy"
                        selectionMode = "range"
                        [(ngModel)]="requestParameter.dates" />
                <p-dropdown id="vehicleId"
                        placeholder="Select Vehicle"
                        [appendTo]="'body'"
                        [filter]="true" 
                        [(ngModel)]="requestParameter.vehicleId"
                        [options]="vehicleOptions"
                        [showClear]="true"
                        (onClear)="onClearCost()" />
                <input pInputText
                       id="search"
                       type="text"
                       placeholder="Search"
                       class="p-inputtext p-component p-element"
                       [(ngModel)]="requestParameter.searchString">
                <p-dropdown [options]="sortFilterOptions"
                            [(ngModel)]="requestParameter.sortFilter"
                            placeholder="Select sort filter" />
                <p-dropdown [options]="sortOrderOptions"
                            [(ngModel)]="requestParameter.sortOrder"
                            placeholder="Select sort order" />
            </div>
            <div class="flex align-items-center justify-content-center gap-2">
                <p-button label="Clear"
                          icon="pi pi-times"
                          pTooltip="Clear filters"
                          tooltipPosition="bottom"
                          [outlined]="true"
                          (onClick)="onClickRefresh()" />
                <p-button label="Filter"
                          pTooltip="Filter data"
                          tooltipPosition="bottom"
                          icon="pi pi-filter"
                          [outlined]="true"
                          (onClick)="onClickSearch()" />
            </div>
        </div>

        <app-divider></app-divider>

        <div class="pt-5"></div>

        <!--table-data-->
        <div class="grid">
            <div class="col">
                <p-table styleClass="p-datatable-sm p-datatable-striped"
                         [value]="costData.data"
                         [paginator]="true"
                         [rows]="requestParameter.pageSize"
                         [rowsPerPageOptions]="[10, 20, 50, 100]"
                         [totalRecords]="costData.totalRecords"
                         (onPage)="onPageChange($event)">
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 2rem">#</th>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Amount Paid</th>
                            <th>Amount Owed</th>
                            <th>Type</th>
                            <th>Vehicle</th>
                            <th style="width:20%">Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-cost let-rowIndex="rowIndex">
                        <tr>
                            <td>{{ rowIndex + 1 }}</td>
                            <td>{{ cost.date | date: 'dd-MMM-Y' }}</td>
                            <td>{{ cost.amount | currency }}</td>
                            <td>{{ cost.amountPaid | currency }}</td>
                            <td>{{ cost.amountOwed | currency }}</td>
                            <td>{{ cost.costType }}</td>
                            <td>{{ cost.vehicle }}</td>
                            <td>
                                <div class="flex flex-wrap column-gap-1 row-gap-1">
                                    <p-button pTooltip="Edit"
                                              tooltipPosition="bottom"
                                              icon="pi pi-pencil"
                                              size="small"
                                              (click)="onClickView(cost.id)" />
                                    <p-button pTooltip="Delete"
                                              tooltipPosition="bottom"
                                              icon="pi pi-trash"
                                              severity="danger"
                                              size="small"
                                              (click)="onClickDelete(cost.id)" />
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="8">
                                No records found
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>
</ng-template>

<!--add vehicle modal-->
<p-dialog header="New Cost"
          [modal]="true"
          [(visible)]="isAddCostModalVisible"
          [style]="{ width: '50rem' }">

    <form [formGroup]="addCostForm">
        <div class="p-fluid p-formgrid grid">
            <div class="field col-6 md:col-6">
                <label class="font-medium" htmlFor="name">Amount</label>
                <p-inputNumber id="amount"
                        formControlName="amount"
                        mode="currency" 
                        currency="USD" 
                        locale="en-US"
                        placeholder="0.00"
                        [ngClass]="{'ng-dirty ng-invalid': addCostForm.get('amount')?.invalid && addCostForm.get('amount')?.touched}" />
                <small class="text-red-700" *ngIf="addCostForm.get('amount')?.invalid && addCostForm.get('amount')?.touched">
                    {{ getErrorMessage('amount') }}
                </small>
            </div>
            <div class="field col-6 md:col-6">
                <label class="font-medium" htmlFor="name">Amount Paid</label>
                <p-inputNumber id="amountPaid"
                        formControlName="amountPaid"
                        mode="currency" 
                        currency="USD" 
                        locale="en-US"
                        placeholder="0.00"
                        [ngClass]="{'ng-dirty ng-invalid': addCostForm.get('amountPaid')?.invalid && addCostForm.get('amountPaid')?.touched}" />
                <small class="text-red-700" *ngIf="addCostForm.get('amountPaid')?.invalid && addCostForm.get('amountPaid')?.touched">
                    {{ getErrorMessage('amountPaid') }}
                </small>
            </div>
        </div>
        <div class="p-fluid p-formgrid grid">
            <div class="field col-12">
                <label class="font-medium" htmlFor="costTypeId">Type</label>
                <p-dropdown id="costTypeId"
                        formControlName="costTypeId"
                        placeholder="Select Cost Type"
                        [appendTo]="'body'"
                        [filter]="true" 
                        [options]="incomeTypeOptions"
                        [showClear]="true" 
                        [ngClass]="{'ng-dirty ng-invalid': addCostForm.get('costTypeId')?.invalid && addCostForm.get('costTypeId')?.touched}" />
                <small class="text-red-700" *ngIf="addCostForm.get('costTypeId')?.invalid && addCostForm.get('costTypeId')?.touched">
                    {{ getErrorMessage('costTypeId') }}
                </small>
            </div>
        </div>
        <div class="p-fluid p-formgrid grid">
            <div class="field col-12">
                <label class="font-medium" htmlFor="vehicleId">Vehicle</label>
                <p-dropdown id="vehicleId"
                        formControlName="vehicleId"
                        placeholder="Select Vehicle"
                        [appendTo]="'body'"
                        [filter]="true" 
                        [options]="vehicleOptions"
                        [showClear]="true" 
                        [ngClass]="{'ng-dirty ng-invalid': addCostForm.get('vehicleId')?.invalid && addCostForm.get('vehicleId')?.touched}" />
                <small class="text-red-700" *ngIf="addCostForm.get('vehicleId')?.invalid && addCostForm.get('vehicleId')?.touched">
                    {{ getErrorMessage('vehicleId') }}
                </small>
            </div>
        </div>
        <div class="p-fluid p-formgrid grid">
            <div class="field col-12">
                <label class="font-medium" htmlFor="name">Date</label>
                <p-calendar id="date"
                        dateFormat="dd-M-yy"
                        formControlName="date"
                        [appendTo]="'body'"
                        [ngClass]="{'ng-dirty ng-invalid': addCostForm.get('date')?.invalid && addCostForm.get('date')?.touched}" />
                <small class="text-red-700" *ngIf="addCostForm.get('date')?.invalid && addCostForm.get('date')?.touched">
                    {{ getErrorMessage('date') }}
                </small>
            </div>
        </div>
    </form>

    <ng-template pTemplate="footer">
        <div class="flex justify-content-end gap-2">
            <p-button label="Cancel" severity="secondary" (onClick)="isAddCostModalVisible = false" />
            <p-button label="Save" (onClick)="onSubmitAddCostForm()" />
        </div>
    </ng-template>

</p-dialog>

<!--page processing-->
<app-page-processing *ngIf="isBusy"></app-page-processing>

<!--toast-->
<p-toast></p-toast>







